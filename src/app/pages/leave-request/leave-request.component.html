<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<!-- Toolbar -->
<p-toolbar styleClass="mb-6">
    <ng-template #start>
        <p-button label="New Leave Request" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
    </ng-template>
</p-toolbar>
<!-- Leave Requests Table -->
<p-table [value]="leaveRequests" dataKey="id" [paginator]="true" [rows]="10" [rowHover]="true"
    [rowsPerPageOptions]="[10, 20, 30]" responsiveLayout="scroll"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} leave requests"
    [showCurrentPageReport]="true" [globalFilterFields]="['employeeName', 'reason', 'status']">

    <!-- Caption with Search -->
    <ng-template #caption>
        <div class="flex items-center justify-between">
            <h5 class="m-0">Manage Leave Requests</h5>
            <p-iconfield>
                <p-inputicon styleClass="pi pi-search" />
                <!-- <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Search..." /> -->
                <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Search..." />

            </p-iconfield>
        </div>
    </ng-template>

    <!-- Table Header -->
    <ng-template pTemplate="header">
        <tr>
            <th>Employee Name</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Days</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template pTemplate="body" let-request>
        <tr>
            <td>{{ request.employeeName || 'N/A' }}</td>
            <td>{{ request.startDate | date: 'yyyy-MM-dd' }}</td>
            <td>{{ request.endDate | date: 'yyyy-MM-dd' }}</td>
            <td>{{ request.daysRequested }}</td>
            <td>{{ request.reason }}</td>
            <td>
                <p-tag [value]="request.status" [severity]="getStatusSeverity(request.status)"></p-tag>
            </td>
            <td>
                <p-button *ngIf="request.status === 'PENDING'" icon="pi pi-check" class="mr-2"
                    severity="success" [rounded]="true" [outlined]="true" (click)="approveLeave(request)" />
                <p-button *ngIf="request.status === 'PENDING'" icon="pi pi-times" class="mr-2"
                    severity="danger" [rounded]="true" [outlined]="true" (click)="rejectLeave(request)" />
                <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true"
                    (click)="editLeave(request)" />
                <p-button icon="pi pi-trash" severity="warn" [rounded]="true" [outlined]="true"
                    (click)="deleteLeave(request)" />
            </td>
        </tr>
    </ng-template>

    <!-- Empty Message -->
    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="7">No leave requests found.</td>
        </tr>
    </ng-template>
</p-table>

<!-- Leave Request Dialog -->
<p-dialog header="New Leave Request" [(visible)]="leaveDialog"
    [style]="{ width: '500px' }" modal [closable]="false" [baseZIndex]="10000">

    <ng-template pTemplate="content">
        <div class="flex justify-center items-center min-h-[300px]">
            <div class="flex flex-col gap-6 w-full max-w-md">

                <div>
                    <label for="startDate" class="block font-bold mb-3">Start Date</label>
                    <p-calendar id="startDate" [(ngModel)]="leaveRequest.startDate" dateFormat="yy-mm-dd"
                        [showIcon]="true" appendTo="body" class="w-full" />
                </div>

                <div>
                    <label for="endDate" class="block font-bold mb-3">End Date</label>
                    <p-calendar id="endDate" [(ngModel)]="leaveRequest.endDate" dateFormat="yy-mm-dd"
                        [showIcon]="true" appendTo="body" class="w-full" />
                </div>

                <div>
                    <label for="reason" class="block font-bold mb-3">Reason</label>
                    <textarea pInputTextarea [(ngModel)]="leaveRequest.reason" rows="3"
                        class="w-full"></textarea>
                </div>

            </div>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <div class="flex justify-end gap-2 w-full">
            <button pButton type="button" label="Cancel" icon="pi pi-times" class="p-button-text"
                (click)="hideDialog()"></button>
            <button pButton type="button" label="Save" icon="pi pi-check" (click)="saveLeave()"></button>
        </div>
    </ng-template>
</p-dialog>
