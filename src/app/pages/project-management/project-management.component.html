<div class="card">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>

    <!-- Toolbar -->
    <p-toolbar>
        <div class="p-toolbar-group-start">
            <h2>Project Management</h2>
        </div>
        <div class="p-toolbar-group-end">
            <button pButton type="button" label="Add Project" icon="pi pi-plus" (click)="openNew()"></button>
        </div>
    </p-toolbar>

    <!-- Projects Table -->
    <p-table [value]="projects" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [rowsPerPageOptions]="[10,25,50]" styleClass="p-datatable-striped">
        <ng-template pTemplate="header">
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Department</th>
                <th>Manager</th>
                <th>Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-project>
            <tr>
                <td>{{ project.name }}</td>
                <td>{{ project.description | slice: 0:50 }}{{ project.description.length > 50 ? '...' : '' }}</td>
                <td>{{ project.startDate | date: 'yyyy-MM-dd' }}</td>
                <td>{{ project.endDate | date: 'yyyy-MM-dd' }}</td>
                <td>
                    <p-tag [value]="project.status" [severity]="getStatusSeverity(project.status)"></p-tag>
                </td>
                <td>{{ getDepartmentName(project.departmentId) }}</td>
                <td>{{ getManagerEmail(project.managerId) }}</td>
                <td>
                    <button pButton type="button" icon="pi pi-pencil" class="p-button-rounded p-button-text"
                        (click)="editProject(project)"></button>
                    <button pButton type="button" icon="pi pi-trash"
                        class="p-button-rounded p-button-text p-button-danger"
                        (click)="confirmDelete(project)"></button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="8">No projects found.</td>
            </tr>
        </ng-template>
    </p-table>

    <!-- Project Dialog -->
    <p-dialog header="{{ editMode ? 'Edit Project' : 'Create Project' }}" [(visible)]="projectDialog"
        [style]="{ width: '500px' }" modal [closable]="false" [baseZIndex]="10000">
        <div class="p-fluid">
            <div class="field">
                <label for="name" class="font-bold">Project Name</label>
                <input id="name" type="text" pInputText [(ngModel)]="project.name" required />
                <small *ngIf="submitted && !project.name" class="p-error">Name is required</small>
            </div>

            <div class="field">
                <label for="description" class="font-bold">Description</label>
                <textarea id="description" pInputTextarea [(ngModel)]="project.description" rows="3"></textarea>
            </div>

            <div class="field">
                <label for="startDate" class="font-bold">Start Date</label>
                <p-calendar id="startDate" [(ngModel)]="project.startDate" dateFormat="yy-mm-dd" [showIcon]="true"
                    appendTo="body"></p-calendar>
            </div>

            <div class="field">
                <label for="endDate" class="font-bold">End Date</label>
                <p-calendar id="endDate" [(ngModel)]="project.endDate" dateFormat="yy-mm-dd" [showIcon]="true"
                    appendTo="body"></p-calendar>
            </div>

            <div class="field">
                <label for="status" class="font-bold">Status</label>
                <p-dropdown id="status" [options]="statusOptions" [(ngModel)]="project.status" optionLabel="label"
                    optionValue="value" placeholder="Select Status" appendTo="body"></p-dropdown>
            </div>

            <div class="field">
                <label for="department" class="font-bold">Department</label>
                <p-dropdown id="department" [options]="departments" [(ngModel)]="project.departmentId"
                    optionLabel="name" optionValue="id" placeholder="Select Department" appendTo="body"></p-dropdown>
                <small *ngIf="submitted && !project.departmentId" class="p-error">Department is required</small>
            </div>

            <div class="field">
                <label for="manager" class="font-bold">Project Manager</label>
                <p-dropdown id="manager" [options]="managers" [(ngModel)]="project.managerId" optionLabel="email"
                    optionValue="id" placeholder="Select Manager" appendTo="body"></p-dropdown>
                <small *ngIf="submitted && !project.managerId" class="p-error">Manager is required</small>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <button pButton type="button" label="Cancel" icon="pi pi-times" class="p-button-text"
                (click)="hideDialog()"></button>
            <button pButton type="button" label="Save" icon="pi pi-check" (click)="saveProject()"></button>
        </ng-template>
    </p-dialog>
</div>
