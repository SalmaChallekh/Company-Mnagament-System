<!DOCTYPE html>
<html>
<head>
    <title>Set Password</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; cursor: pointer; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
<h2>Set Your Password</h2>
<div id="error" class="error"></div>
<div id="success" class="success"></div>

<form id="passwordForm">
    <input type="hidden" id="token" value="">
    <div class="form-group">
        <label for="password">New Password:</label>
        <input type="password" id="password" required>
    </div>
    <div class="form-group">
        <label for="confirmPassword">Confirm Password:</label>
        <input type="password" id="confirmPassword" required>
    </div>
    <button type="submit">Submit</button>
</form>

<script>
    // Get token from URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    document.getElementById('token').value = token;

    // Handle form submission
    document.getElementById('passwordForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            document.getElementById('error').textContent = "Passwords don't match";
            return;
        }

        try {
            const response = await fetch('/api/auth/complete-registration', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    token: token,
                    password: password
                })
            });

            const result = await response.json();

            if (response.ok) {
                document.getElementById('success').textContent = "Password set successfully! You can now login.";
                document.getElementById('error').textContent = "";
            } else {
                document.getElementById('error').textContent = result.error || "Failed to set password";
            }
        } catch (error) {
            document.getElementById('error').textContent = "An error occurred";
        }
    });
</script>
</body>
</html>